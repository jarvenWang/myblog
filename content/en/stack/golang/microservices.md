---
author: "wangjinbao"
title: "å¾®æœåŠ¡"
date: 2022-12-03 00:00:01
description: "å¾®æœåŠ¡çš„ç²¾é«“ï¼šåˆ†è€Œæ²»ä¹‹ï¼Œåˆè€Œç”¨ä¹‹"
draft: false
hideToc: false
enableToc: true
enableTocContent: false
author: wangjinbao
authorEmoji: ğŸ‘»
tags: 
- golang
- categories:




---
>PS: <font color="lightgreen">å¾®æœåŠ¡æ¶æ„ </font> æ˜¯ä¸€ç§è®¾è®¡æ–¹æ³•;
> è€Œ  <font color="lightgreen">å¾®æœåŠ¡</font> è¿™æ˜¯åº”è¯¥æŒ‡ä½¿ç”¨è¿™ç§æ–¹æ³•è€Œè®¾è®¡çš„ä¸€ä¸ªåº”ç”¨ã€‚

## å¾®æœåŠ¡æ¶æ„
å®šä¹‰ï¼šå°†å¤æ‚çš„ç³»ç»Ÿä½¿ç”¨ `ç»„ä»¶åŒ–` çš„æ–¹å¼è¿›è¡Œæ‹†åˆ†ï¼Œå¹¶ä½¿ç”¨è½»é‡çº§ `é€šè®¯æ–¹å¼` è¿›è¡Œæ•´åˆçš„ä¸€ç§è®¾è®¡æ–¹æ³•ã€‚

## å¾®æœåŠ¡
å®šä¹‰ï¼šé€šè¿‡è¿™ç§æ¶æ„è®¾è®¡æ–¹æ³•æ‹†åˆ†å‡ºæ¥çš„ä¸€ä¸ªç‹¬ç«‹çš„ ç»„ä»¶åŒ– çš„ `å°åº”ç”¨` ã€‚

> ç²¾é«“ï¼š"åˆ†è€Œæ²»ä¹‹ï¼Œåˆè€Œç”¨ä¹‹"

### å•ä½“å¼å¼€å‘çš„ç¼ºç‚¹ï¼š
1. å¤æ‚æ€§é€æ¸å˜é«˜
2. æŠ€æœ¯å€ºåŠ¡é€æ¸ä¸Šå‡
3. ç»´æŠ¤æˆæœ¬å¤§
4. æŒç»­äº¤ä»˜å‘¨æœŸé•¿
5. å¯æ‰©å±•æ€§å·®

### å¾®æœåŠ¡å¼å¼€å‘çš„ç‰¹ç‚¹ï¼š
1. å•ä¸€èŒè´£ï¼š
ä¸åŒçš„æœåŠ¡é€šè¿‡ `"ç®¡é“"` æ–¹å¼çµæ´»ç»„åˆ 
2. è½»é‡çº§é€šä¿¡ï¼š
XML å’Œ JSON å®ƒå’Œè¯­è¨€æ— å…³ã€å¹³å°æ— å…³çš„ï¼›å­¦ç”¨åè®®ï¼šé€šä¿¡åè®®ï¼šé€šå¸¸åŸºäºHTTP
3. ç‹¬ç«‹æ€§ï¼š
é«˜åº¦è§£è€¦
4. è¿›ç¨‹éš”ç¦»ï¼š
æ¯ä¸ªæœåŠ¡å•ç‹¬éš”ç¦»

### å¾®æœåŠ¡å¼å¼€å‘çš„ç¼ºç‚¹ï¼š
1. è¿ç»´è¦æ±‚è¾ƒé«˜
æ¯ä¸ªæ¨¡å—å‡ºé—®é¢˜æ—¶æ•´ä¸ªä¸ªé¡¹ç›®è¿è¡Œå¼‚å¸¸ï¼Œä¸å¥½æ’æŸ¥é—®é¢˜ï¼Œè¿ç»´è¦æ±‚é«˜
2. åˆ†å¸ƒå¼çš„å¤æ‚æ€§
3. æ¥å£è°ƒæ•´æˆæœ¬é«˜
ä¸€æ—¦ç”¨æˆ·å¾®æœåŠ¡çš„æ¥å£å‘ç”Ÿå¤§çš„å˜åŠ¨ï¼Œé‚£ä¹ˆæ‰€æœ‰ä¾èµ–å®ƒçš„å¾®æœåŠ¡éƒ½è¦åšç›¸åº”çš„è°ƒæ•´
4. é‡å¤åŠ³åŠ¨
æ¯ä¸ªå¾®æœåŠ¡éƒ½è¦ä¸€ä¸ªå·¥å…·ç±»

### å¾®æœåŠ¡å¼å¼€å‘çš„ä¼˜ç‚¹ï¼š
1. å¼€å‘ç®€å•
æ²¡æœ‰å¤ªå¤šçš„ç´¯èµ˜
2. å¿«é€Ÿå“åº”éœ€æ±‚å˜åŒ–
èƒ½å¤Ÿå¿«é€Ÿçš„å½±å“ä¸šåŠ¡çš„éœ€æ±‚å˜åŒ–
3. éšæ—¶éšåœ°æ›´æ–°
å¾®æœåŠ¡çš„éƒ¨ç½²å’Œæ›´æ–°å¹¶ä¸ä¼šå½±å“ `å…¨å±€ç³»ç»Ÿ` çš„æ­£å¸¸è¿è¡Œï¼›å¤šå®ä¾‹éƒ¨ç½²çš„æƒ…å†µä¸‹ï¼Œæ¯ä¸ªæœåŠ¡çš„é‡å¯å’Œæ›´æ–°ä»»ä½•æ—¶å€™éƒ½å¯ä»¥
4. ç³»ç»Ÿæ›´åŠ ç¨³å®šå¯é 
é«˜å¯ç”¨çš„åˆ†å¸ƒå¼ç¯å¢ƒä¹‹ä¸­ï¼Œæœ‰é…å¥—çš„ `ç›‘æ§ `å’Œ `è°ƒåº¦` ç®¡ç†æœºåˆ¶ï¼Œå¹¶ä¸”è¿˜å¯ä»¥æä¾›è‡ªç”±ä¼¸ç¼©çš„ç®¡ç†ï¼Œå……åˆ†ä¿éšœäº†ç³»ç»Ÿçš„ç¨³å®šå¯é æ€§

## é‡è¦ç»„ä»¶
1. <font color="lightgreen">**protobuf** </font>
è·¨è¯­è¨€ï¼Œè·¨å¹³å° é€šè®¯æ–¹å¼ protobuf
è½»ä¾¿é«˜æ•ˆçš„ç»“æ„åŒ–æ•°æ®å­˜å‚¨æ ¼å¼ï¼Œå¹³å°æ— å…³ã€è¯­è¨€æ— å…³ã€å¯æ‰©å±•
2. <font color="lightgreen">**gRPC** </font>
é€šè®¯åè®® gRPC
3. <font color="lightgreen">**consul** </font>
è°ƒåº¦ç®¡ç†æœåŠ¡å‘ç° consul
4. <font color="lightgreen">**micro** </font>
å¾®æœåŠ¡çš„æ¡†æ¶ micro
5. <font color="lightgreen">**docker** </font>
éƒ¨ç½² docker

#### æ•°æ®äº¤äº’çš„æ ¼å¼æ¯”è¾ƒ
1. <font color="lightgreen">**json**:</font>
ä¸€èˆ¬çš„webé¡¹ç›®ä¸­ï¼Œæœ€æµè¡Œçš„ä¸»è¦è¿˜æ˜¯jsonï¼Œå› ä¸ºæµè§ˆå™¨å¯¹äºjsonæ•°æ®æ”¯æŒéå¸¸å¥½ï¼Œæœ‰å¾ˆå¤šå†…å»ºçš„å‡½æ•°æ”¯æŒ
2. <font color="lightgreen">**xml**:</font>
åœ¨webserviceä¸­åº”è¯¥æœ€ä¸ºå¹¿æ³›ï¼Œä½†æ˜¯ç›¸æ¯”äºjsonï¼Œå®ƒçš„æ•°æ®æ›´å†—ä½™ï¼Œå› ä¸ºéœ€è¦æˆå¯¹çš„é—­åˆæ ‡ç­¾ï¼Œjsonä½¿ç”¨äº†é”®å€¼å¯¹çš„æ–¹å¼ï¼Œä¸ä»…å‹ç¼©äº†ä¸€å®šçš„æ•°æ®ç©ºé—´ï¼ŒåŒæ—¶ä¹Ÿå…·æœ‰å¯ä¸»è¯»æ€§
3. <font color="lightgreen">**protobuf**:</font>
åèµ·ä¹‹ç§€ï¼Œæ˜¯è°·æ­Œå¼€æºçš„ä¸€ç§æ•°æ®æ ¼å¼ï¼Œé€‚åˆé«˜æ€§ï¼Œå¯¹ `å“åº”é€Ÿåº¦æœ‰è¦æ±‚` çš„æ•°æ®ä¼ è¾“åœºæ™¯ã€‚å› ä¸ºprofobufæ˜¯äºŒè¿›åˆ¶æ•°æ®æ ¼å¼ï¼Œéœ€è¦ç¼–ç å’Œè§£ç ã€‚æ•°æ®æœ¬èº«ä¸å…·æœ‰å¯è¯»æ€§ã€‚å› æ­¤åªèƒ½ååºåˆ—åŒ–ä¹‹åå¾—åˆ°çœŸæ­£å¯è¯»çš„æ•°æ®

#### ç›¸å¯¹äºå…¶å®ƒprotobufæ›´å…·æœ‰ä¼˜åŠ¿
1. åºåˆ—åŒ–åä½“ç§¯ç›¸æ¯”jsonå’ŒXMLå¾ˆå°ï¼Œé€‚åˆç½‘ç»œä¼ è¾“
2. æ”¯æŒè·¨å¹³å°å¤šè¯­è¨€
3. æ¶ˆæ¯æ ¼å¼å‡çº§å’Œå…¼å®¹æ€§è¿˜ä¸é”™
4. åºåˆ—åŒ–ååºåˆ—åŒ–é€Ÿåº¦å¾ˆå¿«ï¼Œå¿«äºjsonçš„å¤„ç†é€Ÿåº¦

protobufæœ‰å¦‚ XML ï¼Œä¸è¿‡å®ƒ <font color="lightgreen">æ›´å°ã€æ›´å¿«ã€ä¹Ÿæ›´ç®€å•</font> ã€‚ä½ å¯ä»¥å®šä¹‰è‡ªå·±çš„æ•°æ®ç»“æ„ï¼Œç„¶åä½¿ç”¨ä»£ç ç”Ÿæˆå™¨ç”Ÿæˆçš„ä»£ç æ¥è¯»å†™ä¸€ä¸ªæ•°æ®ç»“æ„ã€‚
ä½ ç”šè‡³å¯ä»¥åœ¨æ— éœ€é‡æ–°éƒ¨ç½²ç¨‹åºçš„æƒ…å†µä¸‹æ›´æ–°æ•°æ®ç»“æ„ã€‚åªéœ€ä½¿ç”¨ Protobuf å¯¹æ•°æ®ç»“æ„è¿›è¡Œä¸€æ¬¡æè¿°ï¼Œå³å¯åˆ©ç”¨å„ç§ä¸åŒè¯­è¨€æˆ–ä»å„ç§ä¸åŒæ•°æ®æµä¸­å¯¹ä½ çš„ç»“æ„åŒ–æ•°æ®è½»æ¾è¯»å†™ã€‚
å®ƒæœ‰ä¸€ä¸ªéå¸¸æ£’çš„ç‰¹æ€§ï¼Œå³ <font color="lightgreen">"å‘å"</font>  å…¼å®¹æ€§å¥½ï¼Œäººä»¬ä¸å¿…ç ´åå·²éƒ¨ç½²çš„ã€ä¾é "è€"æ•°æ®æ ¼å¼çš„ç¨‹åºå°±å¯ä»¥å¯¹æ•°æ®ç»“æ„è¿›è¡Œå‡çº§ã€‚
Protobufè¯­ä¹‰æ›´æ¸…æ™°ï¼Œæ— éœ€ç±»ä¼¼XMLè§£æå™¨çš„ä¸œè¥¿ï¼ˆå› ä¸ºProtobufç¼–è¯‘å™¨ä¼šå°†.protoæ–‡ä»¶ç¼–è¯‘ç”Ÿæˆå¯¹åº”çš„æ•°æ®è®¿é—®ç±»ä¼¼å¯¹Protobufæ•°æ®è¿›è¡Œåºåˆ—åŒ–ã€ååºåˆ—åŒ–æ“ä½œï¼‰ã€‚
Protobufçš„ç¼–ç¨‹æ¨¡å¼æ¯”è¾ƒå‹å¥½ï¼Œç®€å•æ˜“å­¦ï¼ŒåŒæ—¶å®ƒæ‹¥æœ‰è‰¯å¥½çš„æ–‡æ¡£å’Œç¤ºä¾‹ï¼Œå¯¹äºå–œæ¬¢ç®€å•äº‹ç‰©çš„äººè€Œè¨€ï¼Œprotobufæ¯”å…¶ä»–çš„æŠ€æœ¯æ›´åŠ æœ‰å¸å¼•åŠ›ã€‚

## Protobufå®‰è£…
### mac å®‰è£…å¦‚ä¸‹----------

#### 1.Protocå®‰è£…
```shell
brew install protobuf
#éªŒè¯
protoc -h
```


>PS:æŠ¥é”™ï¼šError: protobuf: unknown or unsupported macOS version: :dunno
> æ‰§è¡Œé‡ç½® Homebrew : `brew update-reset`
> 
```shell
brew install protobuf@3.17.3
protoc --version
```
>PS: macoså½“å‰ç³»ç»Ÿä¸æ”¯æŒ autoconf éœ€è¦å‡çº§
ä¸‹è½½åœ°å€ï¼šhttps://alpha.gnu.org/pub/gnu/autoconf/autoconf-2.72c.tar.gz
```shell
å‹ç¼© -> è¿›å…¥ç›®å½•
./configure
make  # ->æç¤ºè¦å‡çº§M4  ï¼Œå»ä¸‹è½½æœ€æ–°ç‰ˆæœ¬ï¼šhttp://ftp.gnu.org/gnu/m4/m4-latest.tar.gz
sudo make install
autoconf --version
autoconf (GNU Autoconf) 2.71
```

>PS: å‡çº§M4çš„æ“ä½œæ­¥éª¤å¦‚ä¸‹ï¼š
```shell
tar -zxvf m4-1.4.19
cd m4-1.4.19
./configure
make
sudo make install
```

#### 2.Protoc-gen-goçš„å®‰è£… 
```shell
# é¦–å…ˆä½ éœ€è¦å°†GOPATHæ·»åŠ åˆ°PATHä¸­ï¼›Macä¸­ åœ¨ç»ˆç«¯è¾“å…¥ env å¯ä»¥æŸ¥çœ‹ç¯å¢ƒå˜é‡ï¼›
# ç›®å‰Macé»˜è®¤çš„ç»ˆç«¯æ˜¯zshï¼Œæ‰€ä»¥éœ€è¦ ç¼–è¾‘ HOME ä¸‹çš„ .zshrc æ–‡ä»¶
vim .zshrc

# vim åœ¨è¾“å…¥æ³•ä¸ºè‹±æ–‡çš„çŠ¶æ€ä¸‹ï¼ŒæŒ‰iè¿›å…¥ç¼–è¾‘æ¨¡å¼ï¼Œå°†ä¸‹è¾¹å†…å®¹æ·»åŠ åˆ°æ–‡ä»¶ä¸­

export GOPATH=$HOME/go

export PATH=$GOPATH/bin:$PATH

# ç„¶å æŒ‰ : è¾“å…¥wq ï¼Œä¿å­˜é€€å‡ºã€‚ é‡è½½ä¸€ä¸‹ .zshrc æ–‡ä»¶

source .zshrc

# ç„¶ååœ¨ç»ˆç«¯æ‰§è¡Œä¸‹æ–¹å‘½ä»¤

go install github.com/golang/protobuf/protoc-gen-go@latest
```
ä¸»è¦çš„å‘½ä»¤ `go install github.com/golang/protobuf/protoc-gen-go@latest`

#### 3.æ ¹æ®protoæ–‡ä»¶ç”Ÿæˆå¯¹åº”çš„GOä»£ç 
æ‰§è¡Œç¼–è¯‘ï¼š
`protoc --go_out=plugins=grpc:./ *.proto #æ·»åŠ grpcæ’ä»¶`
æ›´æ–°ä¸€ä¸‹æ²¡æœ‰çš„ä¾èµ–åŒ…ï¼š
```shell
go get -v -u google.golang.org/grpc
```

```shell
# å½“ä½ å†™å¥½å¯¹åº”çš„Protoæ–‡ä»¶å
# åœ¨ç»ˆç«¯ cd åˆ° proto æ–‡ä»¶çš„ç›®å½•ï¼Œç„¶åæ‰§è¡Œ ä¸‹æ–¹çš„å‘½ä»¤
protoc -I . hello.proto --go_out=plugins=grpc:.

# åœ¨æ­¤é—´æˆ‘é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œåœ¨ protoæ–‡ä»¶ä¸­ optionçš„é—®é¢˜ ä¸èƒ½ç›´æ¥ç”¨ è·¯å¾„ä¸èƒ½ç”¨å•ç‹¬ç”¨ . è‡³å°‘è¦æœ‰ä¸ª /
option go_package= "./;proto";

# å¦‚æ­¤å°±æˆåŠŸé€šè¿‡protoæ–‡ä»¶ç”Ÿæˆgoä»£ç 

# PSï¼šè¡¥å……ä¸ªçŸ¥è¯†
option go_package = "ofc_app;pb_ofc_app_v1";
# option go_packageè¡¨ç¤ºç”Ÿæˆçš„goæ–‡ä»¶çš„å­˜æ”¾åœ°å€å’ŒåŒ…åï¼Œåˆ†å·å‰æ˜¯åœ°å€ï¼Œåˆ†å·åæ˜¯åŒ…åã€‚ 
```


### Linux å®‰è£…å¦‚ä¸‹----------
#### ä¸€ã€ä¸‹è½½ protobuf:
+ æ–¹å¼ä¸€ï¼šï¼ˆæœ¬äººä½¿ç”¨ä¸‹è½½zipï¼‰
#åœ°å€ï¼šhttps://github.com/protocolbuffers/protobuf
æœ¬äººç”¨çš„ protobuf-3.0.x.zip
```shell
git clone https://github.com/protocolbuffers/protobuf.git

```
+ æ–¹å¼äºŒï¼š
#åœ°å€ï¼šhttps://github.com/protocolbuffers/protobuf/releases

####  äºŒã€å®‰è£…ä¾èµ–åº“
```shell
$ sudo apt-get install autoconf automake libtool curl make g++ unzip libffi-dev -y
```
####  ä¸‰ã€å®‰è£…
```shell
cd protobuf/
./autogen.sh
./configure
make
sudo make install
#åˆ·æ–°å…±äº«åº“ï¼Œå¾ˆé‡è¦çš„ä¸€æ­¥
sudo ldconfig 
#å®‰è£…æ—¶å€™ä¼šæ¯”è¾ƒå¡
#æˆåŠŸåéªŒè¯
protoc -h
```
####  å››ã€è·å–protoåŒ…
#GO è¯­è¨€çš„proto APIæ¥å£
#ä¿®æ”¹å›½å†…é•œåƒ
>PS:æŠ¥é”™è¶…æ—¶
> `go env -w GO111MODULE=on`
> `go env -w GOPROXY=https://mirrors.aliyun.com/goproxy/,direct` 
> æˆ– `go env -w GOPROXY=https://goproxy.cn,direct`
> æœ‰æ—¶ä¼šæŠ¥é”™:
> `warning: go env -w GOPROXY=... does not override conflicting OS environment variable`
> è§£å†³æ–¹æ³•ï¼š
> é‡è®¾ä¸€ä¸‹ GOPROXY æ—¢å¯
> <font color="lightgreen">unset GOPROXY</font>

go getå‘½ä»¤ å‚æ•°ï¼š
+ **-u**  : å¼ºåˆ¶ä½¿ç”¨ç½‘ç»œå»æ›´æ–°åŒ…å’Œå®ƒçš„ä¾èµ–åŒ…
+ **-v**  : æ˜¾ç¤ºæ‰§è¡Œçš„å‘½ä»¤
+ **-x**  : æ˜¾ç¤ºç”¨åˆ°çš„å‘½ä»¤
+ **-d** : åªä¸‹è½½ä¸å®‰è£…
+ **-f** : åªæœ‰åœ¨ä½ åŒ…å«äº† -u å‚æ•°çš„æ—¶å€™æ‰æœ‰æ•ˆï¼Œä¸è®© -u å»éªŒè¯ import ä¸­çš„æ¯ä¸€ä¸ªéƒ½å·²ç»è·å–äº†ï¼Œè¿™å¯¹äºæœ¬åœ° fork çš„åŒ…ç‰¹åˆ«æœ‰ç”¨ 
+ **-fix** : åœ¨è·å–æºç ä¹‹åå…ˆè¿è¡Œ fixï¼Œç„¶åå†å»åšå…¶ä»–çš„äº‹æƒ… 
+ **-t** : åŒæ—¶ä¹Ÿä¸‹è½½éœ€è¦ä¸ºè¿è¡Œæµ‹è¯•æ‰€éœ€è¦çš„åŒ…
```shell
$ go get -v -u github.com/golang/protobuf/proto
```
### äº”ã€å®‰è£…protoc-gen-goæ’ä»¶
å®ƒæ˜¯ä¸€ä¸ªgo ç¨‹åºï¼Œç¼–è¯‘å®ƒä¹‹åå°†å¯æ‰§è¡Œæ–‡ä»¶å¤åˆ¶åˆ°/binç›®å½•

```shell
#å®‰è£…
 go get -v -u github.com/golang/protobuf/protoc-gen-go

#å¤åˆ¶ä¸‹è½½çš„å†…å®¹
 mkdir -p /go/src/github.com/golang/
 cp -r /go/pkg/mod/github.com/golang/protobuf\@v1.5.3/ /go/src/github.com/golang/
 mv protobuf\@v1.5.3/ protobuf/
#ç¼–è¯‘
cd $GOPATH/src/github.com/golang/protobuf/protoc-gen-go/
go build

#å°†ç”Ÿæˆçš„ protoc-gen-go å¯æ‰§è¡Œæ–‡ä»¶ï¼Œæ”¾åœ¨/binç›®å½•ä¸‹
sudo cp protoc-gen-go /bin/

#éªŒè¯ç›´æ¥æ‰§è¡Œå‘½ä»¤
protoc-gen-go
```

## Protobufçš„è¯­æ³•
`ã€‚proto` æ–‡ä»¶
å®šä¹‰ä¸€ä¸ªæ¶ˆæ¯ç±»å‹ï¼š
```shell
syntax = "proto3" ;

message PandaRequest{
  string name = 1 ; //åå­—
  int32 shengao = 2 ; //
  repeated int32 tizhong = 3 ;
}

message PandaResponse{
  int32 error = 1 ; //é”™è¯¯å·
  string ermessage = 2 ; //é”™è¯¯ä¿¡æ¯
}
```
## Protobufç¼–è¯‘å™¨
### 1.æ–°å»º.protoæ–‡ä»¶ï¼š
```shell
mkdir -p /go/src/myproto/proto1/
cd /go/src/myproto/proto1/
vim test1.proto
```
### 2.ç¼–è¾‘.protoæ–‡ä»¶
å†…å®¹å¦‚ä¸‹ï¼š
```go
syntax = "proto3";
option go_package = "./"; // æŒ‡å®šç”Ÿæˆçš„goæ–‡ä»¶æ‰€åœ¨path
message PandaRequest{
    string name = 1;
    int32 shengao = 2;
    repeated int32 tizhong = 3;
}
message PandaResponse{
    int32 error = 1;
    string message = 2;
}
```
### 3.ç¼–è¯‘å¯¹åº”è¯­è¨€çš„è„šæœ¬
è°ƒç”¨ç¼–è¯‘å™¨ï¼š
```shell
protoc --proto_path=IMPORT_PATH --cpp_out=DST_DIR --python_out=DST_DIR --go_out=DST_DIR path/to/file.proto
# æˆ–è€…
protoc --go_out=./  *.proto
```
è¯´æ˜ï¼š
1. IMPORT_PATH ï¼š
å£°æ˜äº†ä¸€ä¸ª `.proto` æ–‡ä»¶æ‰€åœ¨çš„è§£æ `import` å…·ä½“ç›®å½•ã€‚å¦‚æœå¿½ç•¥åˆ™ä½¿ç”¨å½“å‰ç›®å½•ã€‚ å¦‚æœæœ‰å¤šä¸ªç›®å½•åˆ™å¯ä»¥å¤šæ¬¡è°ƒç”¨ `--proto_path` ,å®ƒä»¬å°†ä¼šé¡ºåºçš„è¢«è®¿é—®å¹¶æ‰§è¡Œå¯¼å…¥ã€‚<font color="lightgreen">-I=IMPORT_PATH</font> æ˜¯ `--proto_path` çš„ç®€åŒ–å½¢å¼ã€‚
2. cpp_out ï¼š
è¾“å‡ºè·¯å¾„ã€‚ `--cpp_out` åœ¨ç›®æ ‡ç›®å½•DST_DIRä¸­äº§ç”ŸC++ä»£ç ã€‚ `--python_out` åœ¨ç›®æ ‡ç›®å½•DST_DIRä¸­äº§ç”Ÿpythonä»£ç ã€‚`--go_out` åœ¨ç›®æ ‡ç›®å½•DST_DIRä¸­äº§ç”ŸGOä»£ç ã€‚

### 4.éªŒè¯å¹¶æŸ¥çœ‹è„šæœ¬
å½“å‰ç›®å½•ç”Ÿäº§æ–°çš„è„šæœ¬ï¼š
`test1.pb.go`
å†…å®¹æ˜¯goè¯­è¨€è¯­æ³•ï¼š
```go                                                     
// Code generated by protoc-gen-go. DO NOT EDIT.
// versions:
//      protoc-gen-go v1.26.0
//      protoc        (unknown)
// source: test1.proto

package __

import (
        protoreflect "google.golang.org/protobuf/reflect/protoreflect"
        protoimpl "google.golang.org/protobuf/runtime/protoimpl"
        reflect "reflect"
        sync "sync"
)

const (
        // Verify that this generated code is sufficiently up-to-date.
        _ = protoimpl.EnforceVersion(20 - protoimpl.MinVersion)
        // Verify that runtime/protoimpl is sufficiently up-to-date.
        _ = protoimpl.EnforceVersion(protoimpl.MaxVersion - 20)
)
-- VISUAL --                                                          48        1,1           Top
```

| .proto Type | C++ Type | Python Type | Go Type |
|-------------|----------|-------------|---------|
| double      | double   | float       | float64 |
| float       | float    | float       | float32 |
| int32       | int32    | int         | int32   |
| bool        | bool     | bool        | bool    |
| string      | string   | str/unicode | string  |
| bytes       | string   | str         | []byte  |

### æœ‰é»˜è®¤å€¼
### å…¶ä»–æ¶ˆæ¯ç±»å‹
è¦åœ¨ `.proto` æ–‡ä»¶ä¸­æŒ‡å®šï¼Œä¾‹å¦‚ï¼š
```proto
message PersonInfo{
  message Person{
    string name = 1;
    int32 shengo = 2;
    repeated int32 tizhong = 3;
  }
  repeated Person info =1;
}
```
å…¶å®ƒçˆ¶æ¶ˆæ¯ç±»å‹çš„å¤–éƒ¨ä½¿ç”¨è¿™ä¸ªæ¶ˆæ¯ç±»å‹ï¼Œä½¿ç”¨ `.` é“¾å¼å½¢å¼ï¼Œå¦‚ï¼š
```proto
message PersonMessage{
    PersonInfo.Person info = 1;
}
```
## å®šä¹‰æœåŠ¡(Service)
```shell
service SearchService{
  //rpc æœåŠ¡çš„å‡½æ•°å (ä¼ å…¥å‚æ•°) è¿”å› (è¿”å›å‚æ•°)
  rpc Search (SearchRequest) returns (SearchResponse);
}
```

## gRPC
æœ€ç›´è§‚çš„ä½¿ç”¨ `protocol buffer` çš„RPCç³»ç»Ÿæ˜¯ gRPC

gRPC æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½ã€å¼€æºå’Œé€šç”¨çš„ RPC æ¡†æ¶ï¼Œé¢å‘ç§»åŠ¨å’ŒHTTP/2è®¾è®¡ã€‚
ç‰¹æ€§ï¼šåŒå‘æµã€æµæ§ã€å¤´éƒ¨å‹ç¼©ã€å•TCPè¿æ¥ä¸Šçš„å¤šå¤ç”¨è¯·æ±‚ç­‰å¾…ï¼Œå¯¹ç§»åŠ¨è®¾å¤‡æœ‰å¥½ï¼Œæ›´çœç”µã€èŠ‚çœç©ºé—´å ç”¨ã€‚
### æµ‹è¯•
#### 1.ç”ŸæˆgoåŒ…
æµ‹è¯•ç”Ÿæˆçš„proto çš„goåŒ…
```shell
mkdir -p /go/src/myproto/prototext
cd /go/src/myproto/prototext
vim text.proto
```
å†…å®¹å¦‚ä¸‹ï¼š
```proto
syntax = "proto3";
option go_package = "./";
package prototext;
message Test{
    string name = 1;
    repeated int32 tizhong = 2;
    int32 shengao = 3;
    string motto = 4;
}  
```
#### 2.æµ‹è¯•goåŒ…
```shell
mkdir -p /go/src/myproto/test
cd /go/src/myproto/test
vim test.go
```
test.goå†…å®¹ï¼š
```go
package main

import(
        "myproto/prototext"
        "fmt"
        "github.com/golang/protobuf/proto"
)

func main(){
   text:=&prototext.Test{
      Name:"wjb",
      Tizhong:[]int32{120,125,160,166},
      Shengao:181,
      Motto:"good study!",
   }

   fmt.Println(text)

   data,err:=proto.Marshal(text)
   if err!=nil{
       fmt.Println("failed")
   }

   fmt.Println(data)

   newtext:=&prototext.Test{}

   proto.Unmarshal(data.newtext)
   if err!=nil{
       fmt.Println("failed")
   }  
   fmt.Println(newtext)                                                                             
   fmt.Println(newtext.Name)                                                                             
   fmt.Println(newtext.Shengao)   
}
```

### RPC
rpcåŒ…æä¾›äº†é€šè¿‡ç½‘ç»œæˆ–å…¶ä»–I/Oè¿æ¥å¯¹ä¸€ä¸ªå¯¹è±¡çš„å¯¼å‡ºæ–¹æ³•çš„è®¿é—®ã€‚
æœåŠ¡ç«¯æ³¨å†Œä¸€ä¸ªå¯¹è±¡ï¼Œä½¿å®ƒä½œä¸ºä¸€ä¸ªæœåŠ¡è¢«æš´éœ²ï¼ŒæœåŠ¡çš„åå­—æ˜¯è¯¥å¯¹è±¡çš„ç±»å‹åã€‚
æ³¨å†Œä¹‹åï¼Œå¯¹è±¡çš„å¯¼å‡ºæ–¹æ³•å°±å¯ä»¥è¢«è¿œç¨‹è®¿é—®ã€‚
æœåŠ¡ç«¯å¯ä»¥æ³¨å†Œå¤šä¸ªä¸åŒç±»å‹çš„å¯¹è±¡ï¼ˆæœåŠ¡ï¼‰ï¼Œä½†æ³¨å†Œå…·æœ‰ç›¸åŒç±»å‹çš„å¤šä¸ªå¯¹è±¡æ˜¯é”™è¯¯çš„ã€‚

åªæœ‰æ»¡è¶³å¦‚ä¸‹æ ‡å‡†çš„æ–¹æ³•æ‰èƒ½ç”¨äºè¿œç¨‹è®¿é—®ï¼Œå…¶ä½™æ–¹æ³•ä¼šè¢«å¿½ç•¥ï¼š
+ æ–¹æ³•æ˜¯å¯¼å‡ºçš„ (é¦–å­—æ¯å¤§å†™)
+ æ–¹æ³•æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œéƒ½æ˜¯å¯¼å‡ºç±»å‹æˆ–å†…å»ºç±»å‹
+ æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯æŒ‡é’ˆ
+ æ–¹æ³•åªæœ‰ä¸€ä¸ªerroræ¥å£ç±»å‹çš„è¿”å›å€¼

äº‹å®ä¸Šï¼Œæ–¹æ³•å¿…é¡»çœ‹èµ·æ¥åƒè¿™æ ·ï¼š
```go
func (t *T) MethodName(argType T1 , replyType *T2) error
```

#### å®ä¾‹(æœåŠ¡ç«¯+å®¢æˆ·ç«¯)
```shell
rpc
    â”œâ”€â”€ client.go
    â””â”€â”€ server.go
```
server.go å†…å®¹å¦‚ä¸‹ï¼š
```go
package main

import (
	"fmt"
	"io"
	"net"
	"net/http"
	"net/rpc"
)

func pandatext(w http.ResponseWriter, r *http.Request) {
	io.WriteString(w, "hello dante hello panda")
}

/*
+ æ–¹æ³•æ˜¯å¯¼å‡ºçš„ (é¦–å­—æ¯å¤§å†™)
+ æ–¹æ³•æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œéƒ½æ˜¯å¯¼å‡ºç±»å‹æˆ–å†…å»ºç±»å‹
+ æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯æŒ‡é’ˆ
+ æ–¹æ³•åªæœ‰ä¸€ä¸ªerroræ¥å£ç±»å‹çš„è¿”å›å€¼
*/
type Panda int

//å‡½æ•°å…³é”®å­— (å¯¹è±¡) å‡½æ•°å (å¯¹ç«¯å‘é€è¿‡æ¥çš„å†…å®¹ ï¼Œè¿”å›ç»™å¯¹ç«¯çš„å†…å®¹) é”™è¯¯è¿”å›å€¼
func (p *Panda) Getinfo(artType int, replyType *int) error {
	fmt.Println("æ‰“å°å¯¹ç«¯å‘é€è¿‡æ¥çš„å†…å®¹ï¼š", artType)

	//ä¿®æ”¹å†…å®¹å€¤
	*replyType = artType + 1230

	return nil
}

func main() {
	//é¡µé¢çš„è¯·æ±‚
	http.HandleFunc("/panda", pandatext)

	//-1-æœåŠ¡ç«¯æ³¨å†Œä¸€ä¸ªå¯¹è±¡
	pd := new(Panda)
	rpc.Register(pd)
	rpc.HandleHTTP()

	ln, err := net.Listen("tcp", ":10086")
	if err != nil {
		fmt.Println("ç½‘ç»œé”™è¯¯")
	}
	http.Serve(ln, nil)
}
```

è¿è¡Œserver.goï¼š
```shell
go run server.go
æ‰“å°å¯¹ç«¯å‘é€è¿‡æ¥çš„å†…å®¹ï¼š 10086
```

client.go å†…å®¹å¦‚ä¸‹ï¼š
```go
package main

import (
	"fmt"
	"net/rpc"
)

func main() {
	//å»ºç«‹ç½‘ç»œè¿æ¥
	cli, err := rpc.DialHTTP("tcp", "127.0.0.1:10086")
	if err != nil {
		fmt.Println("ç½‘ç»œè¿æ¥å¤±è´¥")
	}

	var pd int
	/*
		func (client *Client) Call(serviceMethod string, args any, reply any) error
	*/
	//-2-è¿æ¥æœåŠ¡
	err = cli.Call("Panda.Getinfo", 10086, &pd)
	if err != nil {
		fmt.Println("æ‰“callå¤±è´¥")
	}
	fmt.Println("æœ€åçš„å€¼ä¸ºï¼š", pd)
}

```
è¿è¡Œclient.goï¼š
```shell
go run client.go
æœ€åçš„å€¼ä¸º; 11316
```

### gRPCå®šä¹‰æœåŠ¡
```shell
myproto
â””â”€â”€ myproto.proto
```
myproto.proto çš„å†…å®¹ï¼š
```proto
syntax = "proto3";

package myproto;

//å®šä¹‰æœåŠ¡
service HelloServer{
    //ä¸€ä¸ªæ‰“æ‹›å‘¼çš„å‡½æ•°
    rpc Sayhello(HelloReq)returns(HelloRsp){}
    //ä¸€ä¸ªè¯´åå­—çš„å‡½æ•°
    rpc Sayname(NameReq)returns(NameRsp){}
}

//å®¢æˆ·ç«¯å‘é€ç»™æœåŠ¡ç«¯
message HelloReq{
    string name = 1;
}
//æœåŠ¡ç«¯è¿”å›ç»™å®¢æˆ·ç«¯
message HelloRsp{
    string msg = 1;
}


//å®¢æˆ·ç«¯å‘é€ç»™æœåŠ¡ç«¯
message NameReq{
    string name = 1;
}
//æœåŠ¡ç«¯è¿”å›ç»™å®¢æˆ·ç«¯
message NameRsp{
    string msg = 1;
}

```
ç¼–è¯‘å¹¶ç”Ÿæˆæ–‡ä»¶ï¼š
```shell
protoc --go_out=./ *.proto #ä¸åŠ grpcæ’ä»¶
protoc --go_out=plugins=grpc:./ *.proto #æ·»åŠ grpcæ’ä»¶
```

#### grpcç¤ºä¾‹
##### 1. æ­¥éª¤ä¸€ï¼šåœ¨å®šä¹‰protoï¼Œå¹¶ç¼–è¯‘

a. æ–°å¢protoæ–‡ä»¶

```shell
echo $GOPATH # /Users/wangdante/go01

# æ–°å»ºç›®å½•newgrpc
mkdir /Users/wangdante/go01/newgrpc

# æ–°å»ºprotoæ–‡ä»¶
cd /Users/wangdante/go01/newgrpc
touch newgrpc.proto
```

b. newgrpc.proto å†…å®¹å¦‚ä¸‹ï¼š

```proto
syntax = "proto3";
option go_package = "./";
package newgrpc;

//å®šä¹‰æœåŠ¡
service HisServer{
    //ä¸€ä¸ªæ‰“æ‹›å‘¼çš„å‡½æ•°
    rpc Sayhis(HiReqs)returns(HiRsps){}
    //ä¸€ä¸ªè¯´åå­—çš„å‡½æ•°
    rpc Saynas(NaReqs)returns(NaRsps){}
}

//å®¢æˆ·ç«¯å‘é€ç»™æœåŠ¡ç«¯
message HiReqs{
    string name = 1;
}
//æœåŠ¡ç«¯è¿”å›ç»™å®¢æˆ·ç«¯
message HiRsps{
    string msg = 1;
}


//å®¢æˆ·ç«¯å‘é€ç»™æœåŠ¡ç«¯
message NaReqs{
    string name = 1;
}
//æœåŠ¡ç«¯è¿”å›ç»™å®¢æˆ·ç«¯
message NaRsps{
    string msg = 1;
}

```

c. ç¼–è¯‘ç”Ÿæˆå¯¹åº”è¯­è¨€çš„goæ–‡ä»¶ newgrpc.pb.go
```shell
protoc --go_out=plugins=grpc:./ *.proto
newgrpc.pb.go
```

d. newgrpc.pb.go å†…å®¹å¦‚ä¸‹ï¼š
```go
// Code generated by protoc-gen-go. DO NOT EDIT.
// versions:
// 	protoc-gen-go v1.26.0
// 	protoc        v4.25.0
// source: newgrpc.proto

package __

import (
	context "context"
	grpc "google.golang.org/grpc"
	codes "google.golang.org/grpc/codes"
	status "google.golang.org/grpc/status"
	protoreflect "google.golang.org/protobuf/reflect/protoreflect"
	protoimpl "google.golang.org/protobuf/runtime/protoimpl"
	reflect "reflect"
	sync "sync"
)

const (
	// Verify that this generated code is sufficiently up-to-date.
	_ = protoimpl.EnforceVersion(20 - protoimpl.MinVersion)
	// Verify that runtime/protoimpl is sufficiently up-to-date.
	_ = protoimpl.EnforceVersion(protoimpl.MaxVersion - 20)
)

//å®¢æˆ·ç«¯å‘é€ç»™æœåŠ¡ç«¯
type HiReqs struct {
	state         protoimpl.MessageState
	sizeCache     protoimpl.SizeCache
	unknownFields protoimpl.UnknownFields

	Name string `protobuf:"bytes,1,opt,name=name,proto3" json:"name,omitempty"`
}

func (x *HiReqs) Reset() {
	*x = HiReqs{}
	if protoimpl.UnsafeEnabled {
		mi := &file_newgrpc_proto_msgTypes[0]
		ms := protoimpl.X.MessageStateOf(protoimpl.Pointer(x))
		ms.StoreMessageInfo(mi)
	}
}

func (x *HiReqs) String() string {
	return protoimpl.X.MessageStringOf(x)
}

func (*HiReqs) ProtoMessage() {}

func (x *HiReqs) ProtoReflect() protoreflect.Message {
	mi := &file_newgrpc_proto_msgTypes[0]
	if protoimpl.UnsafeEnabled && x != nil {
		ms := protoimpl.X.MessageStateOf(protoimpl.Pointer(x))
		if ms.LoadMessageInfo() == nil {
			ms.StoreMessageInfo(mi)
		}
		return ms
	}
	return mi.MessageOf(x)
}

// Deprecated: Use HiReqs.ProtoReflect.Descriptor instead.
func (*HiReqs) Descriptor() ([]byte, []int) {
	return file_newgrpc_proto_rawDescGZIP(), []int{0}
}

func (x *HiReqs) GetName() string {
	if x != nil {
		return x.Name
	}
	return ""
}

//æœåŠ¡ç«¯è¿”å›ç»™å®¢æˆ·ç«¯
type HiRsps struct {
	state         protoimpl.MessageState
	sizeCache     protoimpl.SizeCache
	unknownFields protoimpl.UnknownFields

	Msg string `protobuf:"bytes,1,opt,name=msg,proto3" json:"msg,omitempty"`
}

func (x *HiRsps) Reset() {
	*x = HiRsps{}
	if protoimpl.UnsafeEnabled {
		mi := &file_newgrpc_proto_msgTypes[1]
		ms := protoimpl.X.MessageStateOf(protoimpl.Pointer(x))
		ms.StoreMessageInfo(mi)
	}
}

func (x *HiRsps) String() string {
	return protoimpl.X.MessageStringOf(x)
}

func (*HiRsps) ProtoMessage() {}

func (x *HiRsps) ProtoReflect() protoreflect.Message {
	mi := &file_newgrpc_proto_msgTypes[1]
	if protoimpl.UnsafeEnabled && x != nil {
		ms := protoimpl.X.MessageStateOf(protoimpl.Pointer(x))
		if ms.LoadMessageInfo() == nil {
			ms.StoreMessageInfo(mi)
		}
		return ms
	}
	return mi.MessageOf(x)
}

// Deprecated: Use HiRsps.ProtoReflect.Descriptor instead.
func (*HiRsps) Descriptor() ([]byte, []int) {
	return file_newgrpc_proto_rawDescGZIP(), []int{1}
}

func (x *HiRsps) GetMsg() string {
	if x != nil {
		return x.Msg
	}
	return ""
}

//å®¢æˆ·ç«¯å‘é€ç»™æœåŠ¡ç«¯
type NaReqs struct {
	state         protoimpl.MessageState
	sizeCache     protoimpl.SizeCache
	unknownFields protoimpl.UnknownFields

	Name string `protobuf:"bytes,1,opt,name=name,proto3" json:"name,omitempty"`
}

func (x *NaReqs) Reset() {
	*x = NaReqs{}
	if protoimpl.UnsafeEnabled {
		mi := &file_newgrpc_proto_msgTypes[2]
		ms := protoimpl.X.MessageStateOf(protoimpl.Pointer(x))
		ms.StoreMessageInfo(mi)
	}
}

func (x *NaReqs) String() string {
	return protoimpl.X.MessageStringOf(x)
}

func (*NaReqs) ProtoMessage() {}

func (x *NaReqs) ProtoReflect() protoreflect.Message {
	mi := &file_newgrpc_proto_msgTypes[2]
	if protoimpl.UnsafeEnabled && x != nil {
		ms := protoimpl.X.MessageStateOf(protoimpl.Pointer(x))
		if ms.LoadMessageInfo() == nil {
			ms.StoreMessageInfo(mi)
		}
		return ms
	}
	return mi.MessageOf(x)
}

// Deprecated: Use NaReqs.ProtoReflect.Descriptor instead.
func (*NaReqs) Descriptor() ([]byte, []int) {
	return file_newgrpc_proto_rawDescGZIP(), []int{2}
}

func (x *NaReqs) GetName() string {
	if x != nil {
		return x.Name
	}
	return ""
}

//æœåŠ¡ç«¯è¿”å›ç»™å®¢æˆ·ç«¯
type NaRsps struct {
	state         protoimpl.MessageState
	sizeCache     protoimpl.SizeCache
	unknownFields protoimpl.UnknownFields

	Msg string `protobuf:"bytes,1,opt,name=msg,proto3" json:"msg,omitempty"`
}

func (x *NaRsps) Reset() {
	*x = NaRsps{}
	if protoimpl.UnsafeEnabled {
		mi := &file_newgrpc_proto_msgTypes[3]
		ms := protoimpl.X.MessageStateOf(protoimpl.Pointer(x))
		ms.StoreMessageInfo(mi)
	}
}

func (x *NaRsps) String() string {
	return protoimpl.X.MessageStringOf(x)
}

func (*NaRsps) ProtoMessage() {}

func (x *NaRsps) ProtoReflect() protoreflect.Message {
	mi := &file_newgrpc_proto_msgTypes[3]
	if protoimpl.UnsafeEnabled && x != nil {
		ms := protoimpl.X.MessageStateOf(protoimpl.Pointer(x))
		if ms.LoadMessageInfo() == nil {
			ms.StoreMessageInfo(mi)
		}
		return ms
	}
	return mi.MessageOf(x)
}

// Deprecated: Use NaRsps.ProtoReflect.Descriptor instead.
func (*NaRsps) Descriptor() ([]byte, []int) {
	return file_newgrpc_proto_rawDescGZIP(), []int{3}
}

func (x *NaRsps) GetMsg() string {
	if x != nil {
		return x.Msg
	}
	return ""
}

var File_newgrpc_proto protoreflect.FileDescriptor

var file_newgrpc_proto_rawDesc = []byte{
	0x0a, 0x0d, 0x6e, 0x65, 0x77, 0x67, 0x72, 0x70, 0x63, 0x2e, 0x70, 0x72, 0x6f, 0x74, 0x6f, 0x12,
	0x07, 0x6e, 0x65, 0x77, 0x67, 0x72, 0x70, 0x63, 0x22, 0x1c, 0x0a, 0x06, 0x48, 0x69, 0x52, 0x65,
	0x71, 0x73, 0x12, 0x12, 0x0a, 0x04, 0x6e, 0x61, 0x6d, 0x65, 0x18, 0x01, 0x20, 0x01, 0x28, 0x09,
	0x52, 0x04, 0x6e, 0x61, 0x6d, 0x65, 0x22, 0x1a, 0x0a, 0x06, 0x48, 0x69, 0x52, 0x73, 0x70, 0x73,
	0x12, 0x10, 0x0a, 0x03, 0x6d, 0x73, 0x67, 0x18, 0x01, 0x20, 0x01, 0x28, 0x09, 0x52, 0x03, 0x6d,
	0x73, 0x67, 0x22, 0x1c, 0x0a, 0x06, 0x4e, 0x61, 0x52, 0x65, 0x71, 0x73, 0x12, 0x12, 0x0a, 0x04,
	0x6e, 0x61, 0x6d, 0x65, 0x18, 0x01, 0x20, 0x01, 0x28, 0x09, 0x52, 0x04, 0x6e, 0x61, 0x6d, 0x65,
	0x22, 0x1a, 0x0a, 0x06, 0x4e, 0x61, 0x52, 0x73, 0x70, 0x73, 0x12, 0x10, 0x0a, 0x03, 0x6d, 0x73,
	0x67, 0x18, 0x01, 0x20, 0x01, 0x28, 0x09, 0x52, 0x03, 0x6d, 0x73, 0x67, 0x32, 0x67, 0x0a, 0x09,
	0x48, 0x69, 0x73, 0x53, 0x65, 0x72, 0x76, 0x65, 0x72, 0x12, 0x2c, 0x0a, 0x06, 0x53, 0x61, 0x79,
	0x68, 0x69, 0x73, 0x12, 0x0f, 0x2e, 0x6e, 0x65, 0x77, 0x67, 0x72, 0x70, 0x63, 0x2e, 0x48, 0x69,
	0x52, 0x65, 0x71, 0x73, 0x1a, 0x0f, 0x2e, 0x6e, 0x65, 0x77, 0x67, 0x72, 0x70, 0x63, 0x2e, 0x48,
	0x69, 0x52, 0x73, 0x70, 0x73, 0x22, 0x00, 0x12, 0x2c, 0x0a, 0x06, 0x53, 0x61, 0x79, 0x6e, 0x61,
	0x73, 0x12, 0x0f, 0x2e, 0x6e, 0x65, 0x77, 0x67, 0x72, 0x70, 0x63, 0x2e, 0x4e, 0x61, 0x52, 0x65,
	0x71, 0x73, 0x1a, 0x0f, 0x2e, 0x6e, 0x65, 0x77, 0x67, 0x72, 0x70, 0x63, 0x2e, 0x4e, 0x61, 0x52,
	0x73, 0x70, 0x73, 0x22, 0x00, 0x42, 0x04, 0x5a, 0x02, 0x2e, 0x2f, 0x62, 0x06, 0x70, 0x72, 0x6f,
	0x74, 0x6f, 0x33,
}

var (
	file_newgrpc_proto_rawDescOnce sync.Once
	file_newgrpc_proto_rawDescData = file_newgrpc_proto_rawDesc
)

func file_newgrpc_proto_rawDescGZIP() []byte {
	file_newgrpc_proto_rawDescOnce.Do(func() {
		file_newgrpc_proto_rawDescData = protoimpl.X.CompressGZIP(file_newgrpc_proto_rawDescData)
	})
	return file_newgrpc_proto_rawDescData
}

var file_newgrpc_proto_msgTypes = make([]protoimpl.MessageInfo, 4)
var file_newgrpc_proto_goTypes = []interface{}{
	(*HiReqs)(nil), // 0: newgrpc.HiReqs
	(*HiRsps)(nil), // 1: newgrpc.HiRsps
	(*NaReqs)(nil), // 2: newgrpc.NaReqs
	(*NaRsps)(nil), // 3: newgrpc.NaRsps
}
var file_newgrpc_proto_depIdxs = []int32{
	0, // 0: newgrpc.HisServer.Sayhis:input_type -> newgrpc.HiReqs
	2, // 1: newgrpc.HisServer.Saynas:input_type -> newgrpc.NaReqs
	1, // 2: newgrpc.HisServer.Sayhis:output_type -> newgrpc.HiRsps
	3, // 3: newgrpc.HisServer.Saynas:output_type -> newgrpc.NaRsps
	2, // [2:4] is the sub-list for method output_type
	0, // [0:2] is the sub-list for method input_type
	0, // [0:0] is the sub-list for extension type_name
	0, // [0:0] is the sub-list for extension extendee
	0, // [0:0] is the sub-list for field type_name
}

func init() { file_newgrpc_proto_init() }
func file_newgrpc_proto_init() {
	if File_newgrpc_proto != nil {
		return
	}
	if !protoimpl.UnsafeEnabled {
		file_newgrpc_proto_msgTypes[0].Exporter = func(v interface{}, i int) interface{} {
			switch v := v.(*HiReqs); i {
			case 0:
				return &v.state
			case 1:
				return &v.sizeCache
			case 2:
				return &v.unknownFields
			default:
				return nil
			}
		}
		file_newgrpc_proto_msgTypes[1].Exporter = func(v interface{}, i int) interface{} {
			switch v := v.(*HiRsps); i {
			case 0:
				return &v.state
			case 1:
				return &v.sizeCache
			case 2:
				return &v.unknownFields
			default:
				return nil
			}
		}
		file_newgrpc_proto_msgTypes[2].Exporter = func(v interface{}, i int) interface{} {
			switch v := v.(*NaReqs); i {
			case 0:
				return &v.state
			case 1:
				return &v.sizeCache
			case 2:
				return &v.unknownFields
			default:
				return nil
			}
		}
		file_newgrpc_proto_msgTypes[3].Exporter = func(v interface{}, i int) interface{} {
			switch v := v.(*NaRsps); i {
			case 0:
				return &v.state
			case 1:
				return &v.sizeCache
			case 2:
				return &v.unknownFields
			default:
				return nil
			}
		}
	}
	type x struct{}
	out := protoimpl.TypeBuilder{
		File: protoimpl.DescBuilder{
			GoPackagePath: reflect.TypeOf(x{}).PkgPath(),
			RawDescriptor: file_newgrpc_proto_rawDesc,
			NumEnums:      0,
			NumMessages:   4,
			NumExtensions: 0,
			NumServices:   1,
		},
		GoTypes:           file_newgrpc_proto_goTypes,
		DependencyIndexes: file_newgrpc_proto_depIdxs,
		MessageInfos:      file_newgrpc_proto_msgTypes,
	}.Build()
	File_newgrpc_proto = out.File
	file_newgrpc_proto_rawDesc = nil
	file_newgrpc_proto_goTypes = nil
	file_newgrpc_proto_depIdxs = nil
}

// Reference imports to suppress errors if they are not otherwise used.
var _ context.Context
var _ grpc.ClientConnInterface

// This is a compile-time assertion to ensure that this generated file
// is compatible with the grpc package it is being compiled against.
const _ = grpc.SupportPackageIsVersion6

// HisServerClient is the client API for HisServer service.
//
// For semantics around ctx use and closing/ending streaming RPCs, please refer to https://godoc.org/google.golang.org/grpc#ClientConn.NewStream.
type HisServerClient interface {
	//ä¸€ä¸ªæ‰“æ‹›å‘¼çš„å‡½æ•°
	Sayhis(ctx context.Context, in *HiReqs, opts ...grpc.CallOption) (*HiRsps, error)
	//ä¸€ä¸ªè¯´åå­—çš„å‡½æ•°
	Saynas(ctx context.Context, in *NaReqs, opts ...grpc.CallOption) (*NaRsps, error)
}

type hisServerClient struct {
	cc grpc.ClientConnInterface
}

func NewHisServerClient(cc grpc.ClientConnInterface) HisServerClient {
	return &hisServerClient{cc}
}

func (c *hisServerClient) Sayhis(ctx context.Context, in *HiReqs, opts ...grpc.CallOption) (*HiRsps, error) {
	out := new(HiRsps)
	err := c.cc.Invoke(ctx, "/newgrpc.HisServer/Sayhis", in, out, opts...)
	if err != nil {
		return nil, err
	}
	return out, nil
}

func (c *hisServerClient) Saynas(ctx context.Context, in *NaReqs, opts ...grpc.CallOption) (*NaRsps, error) {
	out := new(NaRsps)
	err := c.cc.Invoke(ctx, "/newgrpc.HisServer/Saynas", in, out, opts...)
	if err != nil {
		return nil, err
	}
	return out, nil
}

// HisServerServer is the server API for HisServer service.
type HisServerServer interface {
	//ä¸€ä¸ªæ‰“æ‹›å‘¼çš„å‡½æ•°
	Sayhis(context.Context, *HiReqs) (*HiRsps, error)
	//ä¸€ä¸ªè¯´åå­—çš„å‡½æ•°
	Saynas(context.Context, *NaReqs) (*NaRsps, error)
}

// UnimplementedHisServerServer can be embedded to have forward compatible implementations.
type UnimplementedHisServerServer struct {
}

func (*UnimplementedHisServerServer) Sayhis(context.Context, *HiReqs) (*HiRsps, error) {
	return nil, status.Errorf(codes.Unimplemented, "method Sayhis not implemented")
}
func (*UnimplementedHisServerServer) Saynas(context.Context, *NaReqs) (*NaRsps, error) {
	return nil, status.Errorf(codes.Unimplemented, "method Saynas not implemented")
}

func RegisterHisServerServer(s *grpc.Server, srv HisServerServer) {
	s.RegisterService(&_HisServer_serviceDesc, srv)
}

func _HisServer_Sayhis_Handler(srv interface{}, ctx context.Context, dec func(interface{}) error, interceptor grpc.UnaryServerInterceptor) (interface{}, error) {
	in := new(HiReqs)
	if err := dec(in); err != nil {
		return nil, err
	}
	if interceptor == nil {
		return srv.(HisServerServer).Sayhis(ctx, in)
	}
	info := &grpc.UnaryServerInfo{
		Server:     srv,
		FullMethod: "/newgrpc.HisServer/Sayhis",
	}
	handler := func(ctx context.Context, req interface{}) (interface{}, error) {
		return srv.(HisServerServer).Sayhis(ctx, req.(*HiReqs))
	}
	return interceptor(ctx, in, info, handler)
}

func _HisServer_Saynas_Handler(srv interface{}, ctx context.Context, dec func(interface{}) error, interceptor grpc.UnaryServerInterceptor) (interface{}, error) {
	in := new(NaReqs)
	if err := dec(in); err != nil {
		return nil, err
	}
	if interceptor == nil {
		return srv.(HisServerServer).Saynas(ctx, in)
	}
	info := &grpc.UnaryServerInfo{
		Server:     srv,
		FullMethod: "/newgrpc.HisServer/Saynas",
	}
	handler := func(ctx context.Context, req interface{}) (interface{}, error) {
		return srv.(HisServerServer).Saynas(ctx, req.(*NaReqs))
	}
	return interceptor(ctx, in, info, handler)
}

var _HisServer_serviceDesc = grpc.ServiceDesc{
	ServiceName: "newgrpc.HisServer",
	HandlerType: (*HisServerServer)(nil),
	Methods: []grpc.MethodDesc{
		{
			MethodName: "Sayhis",
			Handler:    _HisServer_Sayhis_Handler,
		},
		{
			MethodName: "Saynas",
			Handler:    _HisServer_Saynas_Handler,
		},
	},
	Streams:  []grpc.StreamDesc{},
	Metadata: "newgrpc.proto",
}

```
##### 2. æ­¥éª¤äºŒï¼šåœ¨ä¸Šçº§ç›®å½•æ–°å»ºgo.modé¡¹ç›®(æ–¹é¢go get XXX)
ç”Ÿæˆå¯¹åº”çš„goç¼–è¯‘æ–‡ä»¶ä¸­éƒ¨åˆ†ä¾èµ–åŒ…æ²¡æœ‰éœ€è¦ä¸‹è½½ï¼š
```shell
go get -v -u google.golang.org/grpc
```

##### 3. æ­¥éª¤ä¸‰ï¼šæ–°å»ºtestç›®å½•æµ‹è¯•æœåŠ¡ç«¯+å®¢æˆ·ç«¯
```shell
 tree
.
â”œâ”€â”€ client.go
â””â”€â”€ server.go
```
æœåŠ¡ç«¯ï¼šserver.go å†…å®¹å¦‚ä¸‹ï¼š
```go
package main

import (
	"context"
	"fmt"
	"google.golang.org/grpc"
	pd "mymod/newgrpc"
	"net"
)

type server struct {
}

func (this *server) Sayhis(ctx context.Context, in *pd.HiReqs) (out *pd.HiRsps, err error) {
	//return nil, status.Errorf(codes.Unimplemented, "method Sayhis not implemented")
	return &pd.HiRsps{Msg: "hello " + in.Name}, nil
}
func (this *server) Saynas(ctx context.Context, in *pd.NaReqs) (out *pd.NaRsps, err error) {
	//return nil, status.Errorf(codes.Unimplemented, "method Saynas not implemented")
	return &pd.NaRsps{Msg: "æ—©ä¸Šå¥½," + in.Name}, nil
}

func main() {
	ln, err := net.Listen("tcp", ":10086")
	if err != nil {
		fmt.Println("ç½‘ç»œé”™è¯¯", err)
	}

	//åˆ›å»ºgrpcçš„æœåŠ¡
	srv := grpc.NewServer()

	//æ³¨å†ŒæœåŠ¡
	pd.RegisterHisServerServer(srv, &server{})

	//ç­‰å¾…ç½‘ç»œè¿æ¥
	err = srv.Serve(ln)
	if err != nil {
		fmt.Println("ç½‘ç»œé”™è¯¯", err)
	}
}
```

å®¢æˆ·ç«¯ï¼šclient.go å†…å®¹å¦‚ä¸‹ï¼š
```go
package main

import (
	"context"
	"fmt"
	"google.golang.org/grpc"
	pd "mymod/newgrpc"
)

func main() {
	conn, err := grpc.Dial("127.0.0.1:10086", grpc.WithInsecure())
	if err != nil {
		fmt.Println("ç½‘ç»œå¼‚å¸¸", err)
	}
	//å»¶æ—¶å…³é—­ç½‘ç»œ
	defer conn.Close()
	//è·å¾—grpcå¥æŸ„
	c := pd.NewHisServerClient(conn)
	//é€šè¿‡å¥æŸ„è°ƒç”¨å‡½æ•°
	res, err := c.Sayhis(context.Background(), &pd.HiReqs{Name: "å¤§ç‹"})
	if err != nil {
		fmt.Println("SayhisæœåŠ¡è°ƒç”¨å¤±è´¥", err)
	}
	fmt.Println("è°ƒç”¨ Sayhis çš„è¿”å›ï¼š", res.Msg)

	rel, err := c.Saynas(context.Background(), &pd.NaReqs{Name: "å‘¨æ°ä¼¦"})
	if err != nil {
		fmt.Println("Saynas æœåŠ¡è°ƒç”¨å¤±è´¥", err)
	}
	fmt.Println("è°ƒç”¨ Saynas çš„è¿”å›ï¼š", rel.Msg)
}
```

##### 4. æ­¥éª¤å››ï¼šå®¢æˆ·ç«¯è°ƒç”¨æœåŠ¡ç«¯
è¿›å…¥testç›®å½•åˆ†åˆ« å¼€å¯ æœåŠ¡ç«¯ã€å®¢æˆ·ç«¯
```shell
go run server.go
```

```shell
go run client.go
è°ƒç”¨ Sayhis çš„è¿”å›ï¼š hello å¤§ç‹
è°ƒç”¨ Saynas çš„è¿”å›ï¼š æ—©ä¸Šå¥½,å‘¨æ°ä¼¦
```
